<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Gcellbeaconscanner android by david-pugh-gcell</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Gcellbeaconscanner android</h1>
      <h2 class="project-tagline">Example Android Studio Project using the GCellBeaconScan Library to detect nearby beacons.</h2>
      <a href="https://github.com/david-pugh-gcell/GCellBeaconScanner_Android" class="btn">View on GitHub</a>
      <a href="https://github.com/david-pugh-gcell/GCellBeaconScanner_Android/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/david-pugh-gcell/GCellBeaconScanner_Android/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="gcellbeaconscanner-android" class="anchor" href="#gcellbeaconscanner-android" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GCellBeaconScanner Android</h1>

<p>Example Android Studio Project using the GCellBeaconScan aar Library to detect nearby iBeacon devices.</p>

<p>This project is an example Android Studio project that uses the GCellBeaconScanner aar Library to easily set up and detect proximity to nearby iBeacon devices. </p>

<p>For more information about iBeacons, potential applications, the Framework and other software support such as platforms please contact us at <a href="http://www.ibeacon.solar">GCell ibeacon.solar</a>.</p>

<p>Latest version: v1_01 (11 August 2016)</p>

<p>The <em>gcellbeaconscanlibrary</em> module provides all the tools you need to start scanning for iBeacon devices in Android with minimal code. The library allows the developer to scan for nearby iBeacon devices in two ways:</p>

<ol>
<li>Return a list of all nearby iBeacon devices, regardless of their UUID.</li>
<li>Return only information on iBeacon devices from pre-determined Beacon Regions. You can monitor and range these regions, in a method very similar to that used in iOS. </li>
</ol>

<p>There are 4 classes, the one that you will interact most with is the GCellBeaconScanManager
This class handles the Bluetooth scans and returns any scanned devices in range that have an appropriate advertising packet. E.g., once initialized and running it returns callbacks based on what beacons are ranged. This are returned every 1 second in the form of an array list. </p>

<p>Beacons are flushed from the list if they haven’t been seen for x seconds, as defined by setBeaconAutoRefreshRate, this defaults to 10s to match iOS. During this interval the RSSI of any beacon that may have just gone out of range is set to 0 and proximity unknown.</p>

<h3>
<a id="java-documentation--overview" class="anchor" href="#java-documentation--overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Java Documentation &amp; Overview</h3>

<p>For Java documentation please see the repository <a href="https://htmlpreview.github.io/?https://raw.githubusercontent.com/david-pugh-gcell/GCellBeaconScanner_Android/master/GCellBeaconDocs/index.html">docs</a>.</p>

<h3>
<a id="compatibility" class="anchor" href="#compatibility" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compatibility</h3>

<p>The library is designed and tested to work with Android 4.3 (API Level 18) onwards. This API introduces built-in platform support for Bluetooth Low Energy to scan and discover devices. </p>

<h1>
<a id="using-the-library" class="anchor" href="#using-the-library" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using the Library</h1>

<h2>
<a id="adding-the-library-to-your-project" class="anchor" href="#adding-the-library-to-your-project" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Adding the Library to your Project</h2>

<ol>
<li>Download and Copy the <strong>gcellbeaconscanlibrary-release-vX.aar</strong> file into the libs folder in your Android Studio Project.</li>
<li>Within your app build.gradle file add the following entry to allow the app to see the library locally</li>
</ol>

<div class="highlight highlight-text-xml"><pre>  repositories {
        flatDir{
            dirs 'libs'
        }
    }</pre></div>

<ol>
<li>and add the aar as a dependency</li>
</ol>

<div class="highlight highlight-text-xml"><pre>dependencies {
    compile(name:'gcellbeaconscanlibrary-release-v1-01', ext: 'aar')
}</pre></div>

<h2>
<a id="setting-permissions" class="anchor" href="#setting-permissions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting Permissions</h2>

<p>In order to detect beacons your app will need to have manifest permission to access to Bluetooth and your location. To enable these permissions add the following entries to the AndroidManifest.xml file in your app. </p>

<div class="highlight highlight-text-xml"><pre>    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_COARSE_LOCATION<span class="pl-pds">"</span></span>/&gt;
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.BLUETOOTH<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.BLUETOOTH_ADMIN<span class="pl-pds">"</span></span> /&gt;</pre></div>

<p>The library will automatically check for user permissions and the status of Bluetooth Low Energy (BLE) on the device and is compatible with Marshmallow. </p>

<h2>
<a id="import-the-class-definitions" class="anchor" href="#import-the-class-definitions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Import the class definitions</h2>

<div class="highlight highlight-source-java"><pre><span class="pl-k">import</span> <span class="pl-smi">com.gcell.ibeacon.gcellbeaconscanlibrary.GCellBeaconManagerScanEvents</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.gcell.ibeacon.gcellbeaconscanlibrary.GCellBeaconRegion</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.gcell.ibeacon.gcellbeaconscanlibrary.GCellBeaconScanManager</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.gcell.ibeacon.gcellbeaconscanlibrary.GCelliBeacon</span>;
<span class="pl-k">import</span> <span class="pl-smi">com.gcell.ibeacon.gcellbeaconscanlibrary.GCellUuid</span>;</pre></div>

<h2>
<a id="implement-gcellbeaconmanagerscanevents-interface-and-implement-methods" class="anchor" href="#implement-gcellbeaconmanagerscanevents-interface-and-implement-methods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Implement GCellBeaconManagerScanEvents interface and Implement methods</h2>

<div class="highlight highlight-source-java"><pre> <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MainActivity</span> <span class="pl-k">extends</span> <span class="pl-e">Activity</span> <span class="pl-k">implements</span> <span class="pl-e">GCellBeaconManagerScanEvents</span>{</pre></div>

<div class="highlight highlight-source-java"><pre>     <span class="pl-c">// region Handle BeaconScanManager Events</span>

     <span class="pl-c">// This event means the scan manager has updated the ranged beacon list</span>
     <span class="pl-k">public</span> <span class="pl-k">void</span> onGCellUpdateBeaconList(<span class="pl-k">List&lt;<span class="pl-smi">GCelliBeacon</span>&gt;</span> disc_gcell_beacons) {
         <span class="pl-smi">Log</span><span class="pl-k">.</span>i(<span class="pl-c1">TAG</span>, <span class="pl-s"><span class="pl-pds">"</span>Beacons found: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> disc_gcell_beacons<span class="pl-k">.</span>size());
     }

     <span class="pl-c">// This event means the device has enetred a beacon region. To find out more about what beacons are in the region, start ranging.</span>
     <span class="pl-c">// This will return beacon UUID, Major, Minor and RSSI values</span>
     <span class="pl-k">public</span> <span class="pl-k">void</span> didEnterBeaconRegion(<span class="pl-smi">GCellBeaconRegion</span> region) {
         <span class="pl-smi">Log</span><span class="pl-k">.</span>i(<span class="pl-c1">TAG</span>, <span class="pl-s"><span class="pl-pds">"</span>Entered region: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> region<span class="pl-k">.</span>toString());
         mbtManager<span class="pl-k">.</span>startRangingforRegion(region);
     }

     <span class="pl-c">// The device has exited a region, we can now stop ranging for that region to save battery</span>
     <span class="pl-k">public</span> <span class="pl-k">void</span> didExitBeaconRegion(<span class="pl-smi">GCellBeaconRegion</span> region) {
         <span class="pl-smi">Log</span><span class="pl-k">.</span>i(<span class="pl-c1">TAG</span>, <span class="pl-s"><span class="pl-pds">"</span>Exited region: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> region<span class="pl-k">.</span>toString());
         mbtManager<span class="pl-k">.</span>stopRangingforRegion(region);
     }

     <span class="pl-c">// Beacons within a region have been ranged - we now have a list of beacons and their values</span>
     <span class="pl-k">public</span> <span class="pl-k">void</span> didRangeBeaconsinRegion(<span class="pl-smi">GCellBeaconRegion</span> region, <span class="pl-k">List&lt;<span class="pl-smi">GCelliBeacon</span>&gt;</span> disc_gcell_beacons) {
         <span class="pl-smi">Log</span><span class="pl-k">.</span>i(<span class="pl-c1">TAG</span>, <span class="pl-s"><span class="pl-pds">"</span>Beacons found in region: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> disc_gcell_beacons<span class="pl-k">.</span>size() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">+</span> region<span class="pl-k">.</span>toString());

     }

     <span class="pl-c">// The user has denied permission for coarse location.</span>
     <span class="pl-k">public</span> <span class="pl-k">void</span> locationPermissionsDenied(){
         mbtManager<span class="pl-k">.</span>stopScanningForBeacons();
     }

     <span class="pl-c">// Bluetooth Low Energy (BLE) is not supported for this device</span>
     <span class="pl-k">public</span> <span class="pl-k">void</span> bleNotSupported() {

     }

     <span class="pl-c">// BLE is not on for this device</span>
     <span class="pl-k">public</span> <span class="pl-k">void</span> bleNotEnabled() {
         <span class="pl-smi">Log</span><span class="pl-k">.</span>i(<span class="pl-c1">TAG</span>, <span class="pl-s"><span class="pl-pds">"</span>BLE not enabled<span class="pl-pds">"</span></span>);

     }
    <span class="pl-c">// endregion</span></pre></div>

<h2>
<a id="add-permission-handler-for-android-60" class="anchor" href="#add-permission-handler-for-android-60" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add Permission Handler for Android 6.0</h2>

<p>In order to detect and use beacons, your app needs to have location permissions granted. As of Android 6.0 (API level 23) this is classed as a 'Dangerous' permission and as such the user has to explicitly give approval to your app. The GCellBeaconScanManager library automatically checks and, if required, requests the appropriate location permissions in Marshmallow. In order to handle this request properly you need to implement a <em>onRequestPermissionResult</em> method in your Activity. This just calls the <em>permissionResult</em> method in the GCellBeaconScanManager Library which will deal with the values. The GCellBeaconScanManager Library requests permissions with a requestCode value of 1. If you need to request additional permissions in your project, either use a requestCode value greater than 1 or change the code the library uses by changing the value of  <em>coarseLocationRequestcode</em>.</p>

<div class="highlight highlight-source-java"><pre>@<span class="pl-smi">Override</span>
<span class="pl-k">public</span> <span class="pl-k">void</span> onRequestPermissionsResult(<span class="pl-k">int</span> requestCode, <span class="pl-smi">String</span> permissions[], <span class="pl-k">int</span>[] grantResults) {
         <span class="pl-c">//Check to see if this is feedback from the request that the Scan manager made by checking the requestCode</span>
         <span class="pl-k">if</span>(requestCode <span class="pl-k">==</span> mbtManager<span class="pl-k">.</span>getPermissionRequestCode()) {
             mbtManager<span class="pl-k">.</span>handlePermissionResult(requestCode, permissions, grantResults);
         }<span class="pl-k">else</span>{
             <span class="pl-c">//This wasnt a response to the Scan Manager permission another request, handle accordingly</span>
             <span class="pl-smi">Log</span><span class="pl-k">.</span>i(<span class="pl-c1">TAG</span>,<span class="pl-s"><span class="pl-pds">"</span>This was another request<span class="pl-pds">"</span></span>);
         }

}</pre></div>

<h1>
<a id="using-the-library-1" class="anchor" href="#using-the-library-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using the library</h1>

<p>Now the set up is complete, its time to start using the library. The first task is to create an instance object of GCellBeaconScanmanager
Declare a GCellBeaconScanmanager as an instance variable:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">private</span> <span class="pl-smi">GCellBeaconScanManager</span> mbtManager;</pre></div>

<p>Then create an instance within the onCreate method of your Activity:</p>

<div class="highlight highlight-source-java"><pre>        <span class="pl-c">// set up scan manager</span>
        mbtManager <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">GCellBeaconScanManager</span>(<span class="pl-v">this</span>);</pre></div>

<p>There are two ways to use the library:</p>

<h2>
<a id="scanning-for-regions" class="anchor" href="#scanning-for-regions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Scanning for Regions</h2>

<p>This method will be familar to anyone who has used iBeacon within iOS. Beacon regions are defined and information about whether you are within these regions and what beacons that correspond to that region are returned. 
To use this method, set the <em>useBeaconRegions</em> to true.</p>

<div class="highlight highlight-source-java"><pre>        <span class="pl-c">//use known regions</span>
        mbtManager<span class="pl-k">.</span>useBeaconRegions(<span class="pl-c1">true</span>);</pre></div>

<h3>
<a id="defining-a-beacon-region" class="anchor" href="#defining-a-beacon-region" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Defining a Beacon region</h3>

<p>Regions represent the area a user can be in if they can see one or more beacons within range. You can use this capability to generate alerts or to provide other relevant information when the user enters or exits a beacon region. Rather than being identified by fixed geographical coordinates, a beacon region is identified by the device’s proximity to Bluetooth low-energy beacons that advertise a combination of the following values:</p>

<p></p>A proximity UUID (universally unique identifier), which is a 128-bit value that uniquely identifies one or more beacons as a certain type or from a certain organization or project
A major value, which is a 16-bit unsigned integer that can be used to group related beacons that have the same proximity UUID
A minor value, which is a 16-bit unsigned integer that differentiates beacons with the same proximity UUID and major value.

<p>Beacon regions can be defined by their proximity UUID only, Proximity UUID and Major number or by the proximity UUID, Major and Minor Numbers. This gives developers flexibility in how they define iBeacon projects and infastructure. The GCellBeaconRegion class has a number of constructures corresponding to these different definitions, but you can also automatically define a region based on the default GCell UUID.</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">GCellBeaconRegion</span> gCellRegion <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">GCellBeaconRegion</span>(); <span class="pl-c">//Sending no parameters initiates a region using the Default GCell UUID</span>
<span class="pl-smi">GCellBeaconRegion</span> otherRegion <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">GCellBeaconRegion</span>(<span class="pl-k">new</span> <span class="pl-smi">GCellUuid</span>(<span class="pl-s"><span class="pl-pds">"</span>6953fD4f-cfAF-ff58-a9cf-574A5E383c24<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>com.other<span class="pl-pds">"</span></span>);</pre></div>

<p>Then just add these regions to the manager as an ArrayList</p>

<div class="highlight highlight-source-java"><pre>     <span class="pl-k">private</span> <span class="pl-k">ArrayList&lt;<span class="pl-smi">GCellBeaconRegion</span>&gt;</span> beaconRegions <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;<span class="pl-smi">GCellBeaconRegion</span>&gt;</span>();
        <span class="pl-c1">....</span>
     beaconRegions<span class="pl-k">.</span>add(gCellRegion);
    mbtManager<span class="pl-k">.</span>setBeaconRegions(beaconRegions);</pre></div>

<p>Then just start monitoring for these regions.</p>

<div class="highlight highlight-source-java"><pre>    mbtManager<span class="pl-k">.</span>startMonitoringForBeacons();</pre></div>

<p>The library will monitor for BLE devices in low power mode; if any iBeacon devices are in range that correspond to the Beacon Regions defined, the library will call the <em>didEnterRegion</em> method. To start to get more details of the beacons in that region, then call the <em>startMonitoringForBeaconinRegion</em> method.</p>

<div class="highlight highlight-source-java"><pre>    <span class="pl-c">// This event means the device has enetred a beacon region. To find out more about what beacons are in the region, start ranging.</span>
     <span class="pl-c">// This will return beacon UUID, Major, Minor and RSSI values</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> didEnterBeaconRegion(<span class="pl-smi">GCellBeaconRegion</span> region) {
     mbtManager<span class="pl-k">.</span>startRangingforRegion(region);
    }</pre></div>

<p>Details of the iBeacon devices in range will then be returned via the </p>

<div class="highlight highlight-source-java"><pre>         <span class="pl-c">// Beacons within a region have been ranged - we now have a list of beacons and their values</span>
     <span class="pl-k">public</span> <span class="pl-k">void</span> didRangeBeaconsinRegion(<span class="pl-smi">GCellBeaconRegion</span> region, <span class="pl-k">List&lt;<span class="pl-smi">GCelliBeacon</span>&gt;</span> disc_gcell_beacons) {
         <span class="pl-smi">Log</span><span class="pl-k">.</span>i(<span class="pl-c1">TAG</span>, <span class="pl-s"><span class="pl-pds">"</span>Beacons found in region: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> disc_gcell_beacons<span class="pl-k">.</span>size() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">+</span> region<span class="pl-k">.</span>toString());
     }</pre></div>

<h2>
<a id="scanning-for-all-ibeacon-devices" class="anchor" href="#scanning-for-all-ibeacon-devices" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Scanning for all iBeacon Devices</h2>

<p>You can also scan and return a list of all nearby iBeacon devices regardless of their UUID, Major and Minor settings. In this case set <em>useBeaconRegions</em> to false and just start scanning </p>

<div class="highlight highlight-source-java"><pre>mbtManager<span class="pl-k">.</span>useBeaconRegions(<span class="pl-c1">false</span>);
mbtManager<span class="pl-k">.</span>startScanningForBeacons();</pre></div>

<p>This method of operation can be easier to set up, but can be more power hungry and can also leave you with a large list of beacon devices that you then have to manage yourself. These will be returned via * onGCellUpdateBeaconList*.</p>

<div class="highlight highlight-source-java"><pre>     <span class="pl-k">public</span> <span class="pl-k">void</span> onGCellUpdateBeaconList(<span class="pl-k">List&lt;<span class="pl-smi">GCellBleDevice</span>&gt;</span> disc_gcell_beacons) {
         <span class="pl-smi">Log</span><span class="pl-k">.</span>i(<span class="pl-c1">TAG</span>, <span class="pl-s"><span class="pl-pds">"</span>Beacons found: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> disc_gcell_beacons<span class="pl-k">.</span>size());
     }</pre></div>

<h2>
<a id="fine-tuning-the-library" class="anchor" href="#fine-tuning-the-library" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Fine tuning the Library</h2>

<p>You can configure some of the default settings of the library as outlined below and in the documentation. </p>

<div class="highlight highlight-source-java"><pre>
        <span class="pl-c">// Switch debug to true to get feedback from the library during development via Log.i</span>
        mbtManager<span class="pl-k">.</span>enableDeuggingFeedback(<span class="pl-c1">true</span>);
        <span class="pl-c">// Set the library to automatically switch BLE on if it is off or switched off, default is true</span>
        mbtManager<span class="pl-k">.</span>enableBlueToothAutoSwitchOn(<span class="pl-c1">true</span>);
        <span class="pl-c">// Set the auto-refresh rate to 10 s - this is the time we will go without seeing a beacon before deleting it from the ranged list. Default is 8s</span>
        mbtManager<span class="pl-k">.</span>setBeaconAutoRefreshRate(<span class="pl-c1">10</span>);

        <span class="pl-c">//Set the message to display when showing information dialog before requesting permissions to access users location</span>
        mbtManager<span class="pl-k">.</span>setPermissionExplanationMessage(<span class="pl-s"><span class="pl-pds">"</span>Example Feedback Message. We need permission sto see your location before we can see beacons!<span class="pl-pds">"</span></span>);
        <span class="pl-c">// Set the requestCode used to Request Grant Permissions - default is 1</span>
        mbtManager<span class="pl-k">.</span>setPermissionRequestCode(<span class="pl-c1">24</span>);</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/david-pugh-gcell/GCellBeaconScanner_Android">Gcellbeaconscanner android</a> is maintained by <a href="https://github.com/david-pugh-gcell">david-pugh-gcell</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
